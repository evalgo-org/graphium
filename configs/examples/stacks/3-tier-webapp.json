{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "3-tier-webapp",
  "description": "A simple 3-tier web application with nginx, API server, and PostgreSQL database",
  "network": {
    "name": "webapp-network",
    "driver": "bridge",
    "createIfNotExists": true
  },
  "itemListElement": [
    {
      "@type": "SoftwareApplication",
      "position": 1,
      "name": "nginx",
      "image": "nginx:latest",
      "ports": [
        {
          "containerPort": 80,
          "hostPort": 8080,
          "protocol": "tcp"
        }
      ],
      "environment": {
        "API_HOST": "",
        "API_PORT": "3000"
      },
      "volumeMounts": [
        {
          "source": "./nginx.conf",
          "target": "/etc/nginx/nginx.conf",
          "type": "bind",
          "readOnly": true
        }
      ],
      "healthCheck": {
        "type": "http",
        "path": "/health",
        "port": 80,
        "intervalSeconds": 10,
        "timeoutSeconds": 5,
        "retries": 3
      }
    },
    {
      "@type": "SoftwareApplication",
      "position": 2,
      "name": "api",
      "image": "node:18-alpine",
      "ports": [
        {
          "containerPort": 3000,
          "hostPort": 3000,
          "protocol": "tcp"
        }
      ],
      "environment": {
        "NODE_ENV": "production",
        "PORT": "3000",
        "DATABASE_HOST": "",
        "DATABASE_PORT": "5432",
        "DATABASE_NAME": "webapp",
        "DATABASE_USER": "webapp",
        "DATABASE_PASSWORD": "webapp-secret"
      },
      "healthCheck": {
        "type": "http",
        "path": "/health",
        "port": 3000,
        "intervalSeconds": 10,
        "timeoutSeconds": 5,
        "retries": 3
      },
      "dependsOn": ["postgres"]
    },
    {
      "@type": "SoftwareApplication",
      "position": 3,
      "name": "postgres",
      "image": "postgres:14",
      "ports": [
        {
          "containerPort": 5432,
          "hostPort": 5432,
          "protocol": "tcp"
        }
      ],
      "environment": {
        "POSTGRES_DB": "webapp",
        "POSTGRES_USER": "webapp",
        "POSTGRES_PASSWORD": "webapp-secret"
      },
      "volumeMounts": [
        {
          "source": "postgres-data",
          "target": "/var/lib/postgresql/data",
          "type": "volume"
        }
      ],
      "healthCheck": {
        "type": "command",
        "command": ["pg_isready", "-U", "webapp"],
        "intervalSeconds": 10,
        "timeoutSeconds": 5,
        "retries": 5
      }
    }
  ]
}
